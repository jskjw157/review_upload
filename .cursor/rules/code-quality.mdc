---
description: TypeScript/JavaScript ì½”ë“œ í’ˆì§ˆ ê°€ì´ë“œë¼ì¸ - DRY, SOLID, í´ë¦° ì½”ë“œ ì›ì¹™
globs: ["**/*.ts", "**/*.js"]
alwaysApply: false
---

# ì½”ë“œ í’ˆì§ˆ ê°€ì´ë“œë¼ì¸

## ğŸ¯ í•µì‹¬ ë§ˆì¸ë“œì…‹

> "Lines of code = Debt (ì½”ë“œ ì¤„ ìˆ˜ = ë¶€ì±„)"

1. **ë‹¨ìˆœí•¨**: ê°„ë‹¨í•˜ê³  ì§ê´€ì ì¸ ì½”ë“œ ì‘ì„±
2. **ê°€ë…ì„±**: ì½ê¸° ì‰½ê³  ì´í•´í•˜ê¸° ì‰¬ìš´ ì½”ë“œ
3. **ì„±ëŠ¥**: ê°€ë…ì„±ì„ í•´ì¹˜ì§€ ì•ŠëŠ” ë²”ìœ„ ë‚´ì—ì„œ ìµœì í™”
4. **ìœ ì§€ë³´ìˆ˜ì„±**: ì‰½ê²Œ ìˆ˜ì •í•˜ê³  í™•ì¥í•  ìˆ˜ ìˆëŠ” ì½”ë“œ
5. **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°

## âœ… ì½”ë”© ê°€ì´ë“œë¼ì¸

### 1. Early Return íŒ¨í„´ ì‚¬ìš©

```typescript
// âŒ BAD: ì¤‘ì²©ëœ ì¡°ê±´ë¬¸
async function processReview(review: Review) {
  if (review) {
    if (review.content) {
      if (review.content.length > 0) {
        // ì‹¤ì œ ë¡œì§
        return await submitReview(review);
      }
    }
  }
  throw new Error('Invalid review');
}

// âœ… GOOD: Early Returnìœ¼ë¡œ ê°€ë…ì„± í–¥ìƒ
async function processReview(review: Review) {
  if (!review) throw new Error('Review is required');
  if (!review.content) throw new Error('Content is required');
  if (review.content.length === 0) throw new Error('Content cannot be empty');
  
  return await submitReview(review);
}
```

### 2. ì„¤ëª…ì ì¸ ì´ë¦„ ì‚¬ìš©

```typescript
// âŒ BAD: ë¶ˆëª…í™•í•œ ì´ë¦„
const d = new Date();
const x = reviews.filter(r => r.s === 'active');
function proc(data) { ... }

// âœ… GOOD: ëª…í™•í•œ ì´ë¦„
const currentDate = new Date();
const activeReviews = reviews.filter(review => review.status === 'active');
async function processReviewUpload(reviewData: ReviewInput) { ... }

// ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” handle ì ‘ë‘ì‚¬ ì‚¬ìš©
function handleFileSelect() { ... }
function handleFormSubmit() { ... }
function handleAuthCallback() { ... }
```

### 3. ìƒìˆ˜ vs í•¨ìˆ˜

```typescript
// âŒ BAD: ë¶ˆí•„ìš”í•œ í•¨ìˆ˜
function getApiBaseUrl() {
  return 'https://api.cafe24.com';
}

// âœ… GOOD: ìƒìˆ˜ ì‚¬ìš©
const API_BASE_URL = 'https://api.cafe24.com' as const;

// íƒ€ì…ê³¼ í•¨ê»˜ ì‚¬ìš©
const REVIEW_STATUS = {
  PENDING: 'pending',
  APPROVED: 'approved',
  REJECTED: 'rejected',
} as const;

type ReviewStatus = typeof REVIEW_STATUS[keyof typeof REVIEW_STATUS];
```

### 4. DRY (Don't Repeat Yourself)

```typescript
// âŒ BAD: ì¤‘ë³µ ì½”ë“œ
async function uploadSingleReview(review: Review) {
  const headers = {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`,
  };
  const response = await fetch(url, { method: 'POST', headers, body: JSON.stringify(review) });
  return response.json();
}

async function uploadBulkReviews(reviews: Review[]) {
  const headers = {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`,
  };
  const response = await fetch(url, { method: 'POST', headers, body: JSON.stringify(reviews) });
  return response.json();
}

// âœ… GOOD: ê³µí†µ ë¡œì§ ì¶”ì¶œ
function createAuthHeaders(token: string): HeadersInit {
  return {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`,
  };
}

async function postRequest<T>(url: string, data: T, token: string) {
  const response = await fetch(url, {
    method: 'POST',
    headers: createAuthHeaders(token),
    body: JSON.stringify(data),
  });
  return response.json();
}
```

### 5. ë¶ˆë³€ì„± ì„ í˜¸

```typescript
// âŒ BAD: ê°€ë³€ ê°ì²´
const config = { apiUrl: '', token: '' };
config.apiUrl = 'https://api.cafe24.com';
config.token = 'abc123';

// âœ… GOOD: ë¶ˆë³€ ê°ì²´
const config = Object.freeze({
  apiUrl: 'https://api.cafe24.com',
  token: 'abc123',
});

// ë°°ì—´ ì¡°ì‘ë„ ë¶ˆë³€í•˜ê²Œ
// âŒ BAD
reviews.push(newReview);

// âœ… GOOD
const updatedReviews = [...reviews, newReview];
```

### 6. í•¨ìˆ˜ ìˆœì„œ ê·œì¹™

```typescript
// ìƒìœ„ í•¨ìˆ˜ê°€ ë¨¼ì €, êµ¬ì„± ìš”ì†Œ í•¨ìˆ˜ê°€ ë‚˜ì¤‘ì—
export async function uploadReviews(reviews: Review[]) {
  const validReviews = validateReviews(reviews);
  const formattedReviews = formatReviews(validReviews);
  return await submitReviews(formattedReviews);
}

// í—¬í¼ í•¨ìˆ˜ë“¤
function validateReviews(reviews: Review[]): Review[] {
  return reviews.filter(isValidReview);
}

function formatReviews(reviews: Review[]): FormattedReview[] {
  return reviews.map(formatSingleReview);
}

function isValidReview(review: Review): boolean {
  return review.content.length > 0 && review.rating > 0;
}

function formatSingleReview(review: Review): FormattedReview {
  // ...
}
```

## ğŸ“ ì£¼ì„ê³¼ ë¬¸ì„œí™”

### í•¨ìˆ˜ ì£¼ì„
```typescript
/**
 * Cafe24 APIì— ë¦¬ë·°ë¥¼ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
 * 
 * @param reviews - ì—…ë¡œë“œí•  ë¦¬ë·° ë°°ì—´
 * @param config - API ì„¤ì • (mallId, accessToken í¬í•¨)
 * @returns ì—…ë¡œë“œ ê²°ê³¼ (ì„±ê³µ/ì‹¤íŒ¨ ê±´ìˆ˜)
 * @throws {AuthError} í† í°ì´ ë§Œë£Œëœ ê²½ìš°
 * @throws {ApiError} API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ
 */
export async function uploadReviews(
  reviews: Review[],
  config: Cafe24Config
): Promise<UploadResult> {
  // ...
}
```

### TODO ì£¼ì„
```typescript
// TODO: [2024-01-15] í† í° ìë™ ê°±ì‹  ë¡œì§ ì¶”ê°€ í•„ìš”
// FIXME: ëŒ€ìš©ëŸ‰ íŒŒì¼ ì—…ë¡œë“œ ì‹œ ë©”ëª¨ë¦¬ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥
// HACK: Cafe24 APIì˜ ë²„ê·¸ ìš°íšŒë¥¼ ìœ„í•œ ì„ì‹œ ì½”ë“œ
```

## ğŸš« ìµœì†Œ ë³€ê²½ ì›ì¹™

**ì¤‘ìš”**: ì‘ì—…ê³¼ ê´€ë ¨ ì—†ëŠ” ì½”ë“œëŠ” ìˆ˜ì •í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

1. ê¸°ì¡´ ì£¼ì„ ìœ ì§€
2. ê¸°ì¡´ í¬ë§·íŒ… ìœ ì§€
3. ë¶ˆí•„ìš”í•œ ì •ë¦¬ ì‘ì—… ì§€ì–‘
4. ìµœì†Œí•œì˜ ì½”ë“œ ë³€ê²½ìœ¼ë¡œ ëª©í‘œ ë‹¬ì„±

```
ì½”ë“œ ë³€ê²½ = ë²„ê·¸ ë°œìƒ ê°€ëŠ¥ì„± + ê¸°ìˆ  ë¶€ì±„
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ìš©ì´í•œ ì½”ë“œ

```typescript
// âŒ BAD: í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ìš´ ì½”ë“œ (ì™¸ë¶€ ì˜ì¡´ì„± ì§ì ‘ ì‚¬ìš©)
async function refreshToken() {
  const stored = localStorage.getItem('refresh_token');
  const response = await fetch('https://api.cafe24.com/oauth/token', { ... });
  localStorage.setItem('access_token', response.token);
}

// âœ… GOOD: ì˜ì¡´ì„± ì£¼ì…ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ìš©ì´í•˜ê²Œ
interface TokenStorage {
  getRefreshToken(): string | null;
  setAccessToken(token: string): void;
}

async function refreshToken(
  storage: TokenStorage,
  httpClient: HttpClient
): Promise<void> {
  const refreshToken = storage.getRefreshToken();
  if (!refreshToken) throw new Error('No refresh token');
  
  const response = await httpClient.post('/oauth/token', { refreshToken });
  storage.setAccessToken(response.token);
}
```
