---
description: Electron IPC í†µì‹  íŒ¨í„´ ë° íƒ€ì… ì•ˆì „í•œ êµ¬í˜„ ê°€ì´ë“œ
globs: ["src/main/**/*.ts", "src/renderer/**/*.ts", "src/types/ipc.ts"]
alwaysApply: false
---

# IPC í†µì‹  íŒ¨í„´ ê°€ì´ë“œ

## ğŸ“¡ IPC ì±„ë„ ë„¤ì´ë° ì»¨ë²¤ì…˜

### íŒ¨í„´: `domain:action`
```typescript
// âœ… ê¶Œì¥ ë„¤ì´ë°
'auth:exchange'      // ì¸ì¦ ì½”ë“œ êµí™˜
'auth:refresh'       // í† í° ê°±ì‹ 
'auth:load'          // ì €ì¥ëœ í† í° ë¡œë“œ
'review:submit'      // ë‹¨ì¼ ë¦¬ë·° ì œì¶œ
'review:bulk'        // ëŒ€ëŸ‰ ë¦¬ë·° ì—…ë¡œë“œ
'file:select'        // íŒŒì¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸
'window:minimize'    // ì°½ ìµœì†Œí™”

// âŒ í”¼í•´ì•¼ í•  ë„¤ì´ë°
'doSomething'        // ë„ë©”ì¸ ë¶ˆëª…í™•
'handle-auth'        // ì¼ê´€ì„± ì—†ëŠ” êµ¬ë¶„ì
'AUTH_EXCHANGE'      // ëŒ€ë¬¸ì ì‚¬ìš©
```

## ğŸ—ï¸ íƒ€ì… ì•ˆì „í•œ IPC ì‹œìŠ¤í…œ

### 1. ì±„ë„ ì •ì˜ (types/ipc.ts)
```typescript
// ëª¨ë“  IPC ì±„ë„ê³¼ í˜ì´ë¡œë“œ íƒ€ì…ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬
export interface IpcChannelMap {
  // ì¸ì¦ ê´€ë ¨
  'auth:exchange': {
    request: AuthCodePayload;
    response: Promise<TokenResponse>;
  };
  'auth:refresh': {
    request: Cafe24Config;
    response: Promise<TokenResponse>;
  };
  'auth:load': {
    request: void;
    response: Promise<StoredTokens | null>;
  };
  
  // ë¦¬ë·° ê´€ë ¨
  'review:submit': {
    request: ReviewRequestPayload;
    response: Promise<ReviewResponse>;
  };
  'review:bulk': {
    request: BulkUploadPayload;
    response: Promise<BulkUploadResponse>;
  };
}

// ì±„ë„ ì´ë¦„ íƒ€ì…
export type IpcChannel = keyof IpcChannelMap;
```

### 2. íƒ€ì… ì•ˆì „í•œ Main Process Handler
```typescript
// services/ipc-registry.ts
import { ipcMain, IpcMainInvokeEvent } from 'electron';

type IpcHandler<C extends IpcChannel> = (
  event: IpcMainInvokeEvent,
  payload: IpcChannelMap[C]['request']
) => IpcChannelMap[C]['response'];

function registerHandler<C extends IpcChannel>(
  channel: C,
  handler: IpcHandler<C>
): void {
  ipcMain.handle(channel, handler);
}

// ì‚¬ìš© ì˜ˆì‹œ
registerHandler('auth:exchange', async (_, payload) => {
  // payloadëŠ” ìë™ìœ¼ë¡œ AuthCodePayload íƒ€ì…
  return exchangeAuthCode(payload.code, payload.config);
});
```

### 3. íƒ€ì… ì•ˆì „í•œ Preload Bridge
```typescript
// preload.ts
import { contextBridge, ipcRenderer } from 'electron';

// íƒ€ì… ì•ˆì „í•œ invoke ë˜í¼
function createInvoker<C extends IpcChannel>(channel: C) {
  return (payload: IpcChannelMap[C]['request']): IpcChannelMap[C]['response'] => {
    return ipcRenderer.invoke(channel, payload);
  };
}

// API ë…¸ì¶œ
contextBridge.exposeInMainWorld('api', {
  auth: {
    exchange: createInvoker('auth:exchange'),
    refresh: createInvoker('auth:refresh'),
    load: createInvoker('auth:load'),
  },
  review: {
    submit: createInvoker('review:submit'),
    bulk: createInvoker('review:bulk'),
  },
});
```

### 4. Rendererì—ì„œ ì‚¬ìš©
```typescript
// global.d.ts
interface Window {
  api: {
    auth: {
      exchange: (payload: AuthCodePayload) => Promise<TokenResponse>;
      refresh: (config: Cafe24Config) => Promise<TokenResponse>;
      load: () => Promise<StoredTokens | null>;
    };
    review: {
      submit: (payload: ReviewRequestPayload) => Promise<ReviewResponse>;
      bulk: (payload: BulkUploadPayload) => Promise<BulkUploadResponse>;
    };
  };
}

// ì‚¬ìš©
const tokens = await window.api.auth.exchange({ code, config });
```

## ğŸ”„ ì–‘ë°©í–¥ í†µì‹  íŒ¨í„´

### Main â†’ Renderer ì´ë²¤íŠ¸ (ì§„í–‰ë¥  ë“±)
```typescript
// types/ipc.tsì— ì´ë²¤íŠ¸ íƒ€ì… ì¶”ê°€
export interface IpcEventMap {
  'upload:progress': { current: number; total: number; percentage: number };
  'upload:error': { message: string; code: string };
  'upload:complete': { successCount: number; failCount: number };
}

// Main Processì—ì„œ ì „ì†¡
function sendToRenderer<E extends keyof IpcEventMap>(
  window: BrowserWindow,
  event: E,
  data: IpcEventMap[E]
): void {
  window.webContents.send(event, data);
}

// ì‚¬ìš©
sendToRenderer(mainWindow, 'upload:progress', {
  current: 50,
  total: 100,
  percentage: 50,
});

// Preloadì—ì„œ ìˆ˜ì‹  í•¸ë“¤ëŸ¬ ë…¸ì¶œ
contextBridge.exposeInMainWorld('events', {
  onProgress: (callback: (data: IpcEventMap['upload:progress']) => void) => {
    ipcRenderer.on('upload:progress', (_, data) => callback(data));
    return () => ipcRenderer.removeAllListeners('upload:progress');
  },
});
```

## ğŸ›¡ï¸ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´

### í‘œì¤€í™”ëœ ì‘ë‹µ í¬ë§·
```typescript
// types/ipc.ts
export interface IpcResult<T> {
  success: true;
  data: T;
}

export interface IpcError {
  success: false;
  error: {
    code: string;
    message: string;
    details?: unknown;
  };
}

export type IpcResponse<T> = IpcResult<T> | IpcError;

// Handlerì—ì„œ ì‚¬ìš©
ipcMain.handle('review:submit', async (_, payload): Promise<IpcResponse<ReviewData>> => {
  try {
    const data = await submitReview(payload);
    return { success: true, data };
  } catch (error) {
    return {
      success: false,
      error: {
        code: 'REVIEW_SUBMIT_FAILED',
        message: error instanceof Error ? error.message : 'Unknown error',
      },
    };
  }
});

// Rendererì—ì„œ ì²˜ë¦¬
const result = await window.api.review.submit(payload);
if (!result.success) {
  showError(result.error.message);
  return;
}
// result.data ì‚¬ìš©
```

## ğŸ“Š ëŒ€ìš©ëŸ‰ ë°ì´í„° ì „ì†¡

### íŒŒì¼ ì „ì†¡ ìµœì í™”
```typescript
// âŒ BAD: ì „ì²´ ë²„í¼ë¥¼ IPCë¡œ ì „ì†¡
ipcMain.handle('file:upload', (_, buffer: Buffer) => {
  // í° íŒŒì¼ì€ ë©”ëª¨ë¦¬ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥
});

// âœ… GOOD: íŒŒì¼ ê²½ë¡œë§Œ ì „ì†¡í•˜ê³  Mainì—ì„œ ì²˜ë¦¬
ipcMain.handle('file:upload', async (_, filePath: string) => {
  const buffer = await fs.promises.readFile(filePath);
  return processFile(buffer);
});

// âœ… BETTER: ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
ipcMain.handle('file:upload', async (_, filePath: string) => {
  return new Promise((resolve, reject) => {
    const stream = fs.createReadStream(filePath);
    const chunks: Buffer[] = [];
    
    stream.on('data', (chunk) => {
      chunks.push(chunk);
      // ì§„í–‰ë¥  ì „ì†¡
      mainWindow?.webContents.send('upload:progress', {
        current: chunks.length,
        // ...
      });
    });
    
    stream.on('end', () => resolve(Buffer.concat(chunks)));
    stream.on('error', reject);
  });
});
```

## ğŸ§¹ ë¦¬ì†ŒìŠ¤ ì •ë¦¬

### ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
```typescript
// Renderer (React ì˜ˆì‹œ)
useEffect(() => {
  const cleanup = window.events.onProgress((data) => {
    setProgress(data.percentage);
  });
  
  return () => cleanup(); // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ ì •ë¦¬
}, []);
```
