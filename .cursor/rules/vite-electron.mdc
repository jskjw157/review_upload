---
description: Vite + Electron ë¹Œë“œ ìµœì í™” ë° ì„¤ì • ê°€ì´ë“œ
globs: ["vite.*.config.ts", "vite.config.ts"]
alwaysApply: false
---

# Vite + Electron ë¹Œë“œ ìµœì í™”

## ğŸ—ï¸ ë©€í‹° ë¹Œë“œ ì„¤ì •

Electron í”„ë¡œì íŠ¸ëŠ” Mainê³¼ Rendererë¥¼ ìœ„í•œ ë³„ë„ Vite ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

### íŒŒì¼ êµ¬ì¡°
```
â”œâ”€â”€ vite.main.config.ts      # Main Process ë¹Œë“œ
â”œâ”€â”€ vite.renderer.config.ts  # Renderer Process ë¹Œë“œ
â””â”€â”€ vite.preload.config.ts   # Preload ìŠ¤í¬ë¦½íŠ¸ (ì„ íƒì )
```

## âš™ï¸ Main Process ì„¤ì • (vite.main.config.ts)

```typescript
import { defineConfig } from 'vite';
import path from 'node:path';

export default defineConfig({
  build: {
    // Node.js í™˜ê²½ íƒ€ê²Ÿ
    target: 'node18',
    outDir: 'dist-electron',
    lib: {
      entry: 'src/main/main.ts',
      formats: ['cjs'],
      fileName: () => 'main.js',
    },
    rollupOptions: {
      // Electron ë° Node.js ë‚´ì¥ ëª¨ë“ˆ ì™¸ë¶€í™”
      external: ['electron', ...builtinModules],
    },
    minify: false,
    sourcemap: true,
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
});
```

## ğŸ¨ Renderer Process ì„¤ì • (vite.renderer.config.ts)

```typescript
import { defineConfig } from 'vite';
import path from 'node:path';

export default defineConfig({
  root: '.',
  base: './', // ìƒëŒ€ ê²½ë¡œ ì‚¬ìš© (íŒ¨í‚¤ì§• ì‹œ ì¤‘ìš”)
  build: {
    target: 'chrome120', // Electronì˜ Chromium ë²„ì „ì— ë§ì¶¤
    outDir: 'dist',
    emptyOutDir: true,
    rollupOptions: {
      input: path.resolve(__dirname, 'index.html'),
    },
  },
  // ê°œë°œ ì„œë²„ ì„¤ì •
  server: {
    port: 5173,
    strictPort: true,
  },
});
```

## ğŸš€ ë¹Œë“œ ìµœì í™” ì „ëµ

### 1. ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…
```typescript
// Rendererì˜ rollupOptions
rollupOptions: {
  output: {
    manualChunks: {
      vendor: ['react', 'react-dom'],
      utils: ['lodash-es', 'date-fns'],
    },
  },
}
```

### 2. íŠ¸ë¦¬ ì‰ì´í‚¹ ìµœì í™”
```typescript
// ì‚¬ì´ë“œ ì´í™íŠ¸ ì—†ëŠ” ëª¨ë“ˆ í‘œì‹œ (package.json)
{
  "sideEffects": false
}

// ë˜ëŠ” íŠ¹ì • íŒŒì¼ë§Œ ì‚¬ì´ë“œ ì´í™íŠ¸ ìˆìŒ
{
  "sideEffects": ["*.css", "*.scss"]
}
```

### 3. ì™¸ë¶€ ëª¨ë“ˆ ì²˜ë¦¬
```typescript
// Main Processì—ì„œ ì™¸ë¶€í™”í•  ëª¨ë“ˆ
import { builtinModules } from 'node:module';

const external = [
  'electron',
  ...builtinModules,
  ...builtinModules.map(m => `node:${m}`),
];
```

## ğŸ“¦ íŒ¨í‚¤ì§• ê³ ë ¤ì‚¬í•­

### asar íŒ¨í‚¤ì§•ê³¼ í˜¸í™˜ì„±
```typescript
// ë„¤ì´í‹°ë¸Œ ëª¨ë“ˆ ì‚¬ìš© ì‹œ
rollupOptions: {
  external: ['better-sqlite3', 'sharp'], // ë„¤ì´í‹°ë¸Œ ëª¨ë“ˆ ì™¸ë¶€í™”
}
```

### ë¦¬ì†ŒìŠ¤ ê²½ë¡œ ì²˜ë¦¬
```typescript
// ê°œë°œê³¼ í”„ë¡œë•ì…˜ì—ì„œ ë‹¤ë¥¸ ê²½ë¡œ
const resourcePath = app.isPackaged
  ? path.join(process.resourcesPath, 'assets')
  : path.join(__dirname, '..', 'assets');
```

## ğŸ”§ ê°œë°œ ì›Œí¬í”Œë¡œìš° ìµœì í™”

### Hot Reload ì„¤ì •
```typescript
// ê°œë°œ ìŠ¤í¬ë¦½íŠ¸ (package.json)
{
  "scripts": {
    "dev": "concurrently \"npm:dev:renderer\" \"npm:dev:electron\"",
    "dev:renderer": "vite dev --config vite.renderer.config.ts",
    "dev:electron": "VITE_DEV_SERVER_URL=http://localhost:5173 electron ."
  }
}
```

### í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
```typescript
// Main Processì—ì„œ Vite ê°œë°œ ì„œë²„ URL ê°ì§€
const isDev = process.env.NODE_ENV === 'development';
const devServerUrl = process.env.VITE_DEV_SERVER_URL;

if (isDev && devServerUrl) {
  await window.loadURL(devServerUrl);
} else {
  await window.loadFile('dist/index.html');
}
```

## ğŸ“Š ë²ˆë“¤ ë¶„ì„

```typescript
// vite.config.tsì— ì¶”ê°€
import { visualizer } from 'rollup-plugin-visualizer';

plugins: [
  visualizer({
    filename: 'bundle-stats.html',
    open: true,
    gzipSize: true,
  }),
]
```

## âš ï¸ ì¼ë°˜ì ì¸ í•¨ì •

### 1. __dirname ë¬¸ì œ
```typescript
// ESMì—ì„œ __dirname ì‚¬ìš©
import { fileURLToPath } from 'node:url';
import path from 'node:path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
```

### 2. ìƒëŒ€ ê²½ë¡œ vs ì ˆëŒ€ ê²½ë¡œ
```typescript
// âŒ BAD: ê°œë°œì—ì„œë§Œ ë™ì‘
await window.loadFile('/dist/index.html');

// âœ… GOOD: íŒ¨í‚¤ì§• í›„ì—ë„ ë™ì‘
await window.loadFile(path.join(__dirname, '..', 'dist', 'index.html'));
```

### 3. CSS ê²½ë¡œ ë¬¸ì œ
```typescript
// baseë¥¼ ìƒëŒ€ ê²½ë¡œë¡œ ì„¤ì •
base: './',  // '/' ëŒ€ì‹  './' ì‚¬ìš©
```
